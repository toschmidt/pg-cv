from os import path

from database import Database


# delete all metadata for the view approaches (e.g., the schema 'cv' for the continuous view approach)
class ClearViews:

    def __init__(self, db: Database, config: dict):
        self.db = db
        self.config = config

    def execute(self):
        src = self.config['src']

        self.db.execute_file(path.join(src, 'clear.sql'), self.config)


# clear data in public schema (i.e., the TPC-H relations)
class ClearPublic:

    def __init__(self, db: Database, config: dict):
        self.db = db
        self.config = config

    def execute(self):
        src = self.config['src']
        dataset = self.config['dataset']

        self.db.execute_file(path.join(src, dataset, 'clear.sql'), self.config)


# clear the tables, views and functions generated by the query when calling 'setup'
class ClearQuery:

    def __init__(self, db: Database, config: dict):
        self.db = db
        self.config = config

    def execute(self):
        src = self.config['src']
        dataset = self.config['dataset']
        query_type = self.config['query_type']
        query = self.config['query']

        # find script to execute
        if path.isfile(path.join(src, dataset, query_type, 'clear.sql')):
            self.db.execute_file(path.join(src, dataset, query_type, 'clear.sql'), self.config)
        else:
            self.db.execute_file(path.join(src, dataset, query_type, query, 'clear.sql'), self.config)
